# nextest configuration for nix-bench

[profile.default]
# Increase timeout for integration tests that spin up AWS resources
slow-timeout = { period = "60s", terminate-after = 3 }
# Use all available threads for unit tests (default behavior)
# test-threads is not set, so nextest uses num_cpus

[profile.default.junit]
path = "target/nextest/default/junit.xml"

# AWS integration tests: run serially to avoid rate limiting, longer timeouts
[[profile.default.overrides]]
filter = 'binary(~aws) | binary(~agent_e2e)'
test-group = 'aws-tests'
slow-timeout = { period = "120s", terminate-after = 5 }

[test-groups.aws-tests]
max-threads = 1

[profile.ci]
# CI profile with longer timeouts
slow-timeout = { period = "120s", terminate-after = 2 }
fail-fast = false

# Profile for nix builds - skip integration tests that need AWS credentials
[profile.nix]
test-threads = 1
# Run all tests except integration test binaries (in tests/ directory)
default-filter = 'not kind(test)'
